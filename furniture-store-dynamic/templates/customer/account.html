{% extends "base.html" %}

{% block title %}T√†i Kho·∫£n - N·ªôi Th·∫•t ABC{% endblock %}

{% block content %}
<div class="account-section">
    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">
                        <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-circle' }}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="account-container">
            <aside class="account-sidebar">
                <h3><i class="fas fa-user-circle"></i> {{ customer.full_name }}</h3>
                <ul class="account-menu">
                    <li><a href="#info" class="active"><i class="fas fa-info-circle"></i> Th√¥ng tin t√†i kho·∫£n</a></li>
                    <li><a href="#orders"><i class="fas fa-shopping-bag"></i> ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
                    <li><a href="#password"><i class="fas fa-key"></i> ƒê·ªïi m·∫≠t kh·∫©u</a></li>
                    <li><a href="{{ url_for('customer_logout') }}"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</a></li>
                </ul>
            </aside>
            
            <main class="account-content">
                <section id="info">
                    <h2>Th√¥ng Tin T√†i Kho·∫£n</h2>
                    <form method="POST" action="{{ url_for('update_customer_info') }}">
                        <div class="form-group">
                            <label for="full_name">H·ªç v√† t√™n</label>
                            <input type="text" id="full_name" name="full_name" value="{{ customer.full_name }}" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" value="{{ customer.email }}" disabled>
                            <small style="color: var(--text-light);">Email kh√¥ng th·ªÉ thay ƒë·ªïi</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
                            <input type="tel" id="phone" name="phone" value="{{ customer.phone or '' }}">
                        </div>
                        
                        <div class="form-group">
                            <label for="address">ƒê·ªãa ch·ªâ</label>
                            <textarea id="address" name="address" rows="3">{{ customer.address or '' }}</textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> C·∫≠p Nh·∫≠t
                        </button>
                    </form>
                </section>
                
                <section id="orders" class="mt-5">
                    <h2>ƒê∆°n H√†ng C·ªßa T√¥i</h2>
                    {% if orders %}
                        <ul class="orders-list">
                            {% for order in orders %}
                            <li class="order-item">
                                <div class="order-header">
                                    <span class="order-id">#{{ order.order_id }}</span>
                                    <span class="order-status {{ order.status }}">
                                        {% if order.status == 'pending' %}
                                            ‚è≥ Ch·ªù x√°c nh·∫≠n
                                        {% elif order.status == 'confirmed' %}
                                            ‚úì ƒê√£ x√°c nh·∫≠n
                                        {% elif order.status == 'shipping' %}
                                            üöö ƒêang giao
                                        {% elif order.status == 'completed' %}
                                            ‚úì ƒê√£ ho√†n th√†nh
                                        {% elif order.status == 'cancelled' %}
                                            ‚úó ƒê√£ h·ªßy
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="order-details">
                                    <p><strong>Ng√†y ƒë·∫∑t:</strong> {{ order.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
                                    <p><strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> 
                                        {% if order.payment_method == 'cod' %}
                                            COD (Thanh to√°n khi nh·∫≠n h√†ng)
                                        {% elif order.payment_method == 'bank_transfer' %}
                                            Chuy·ªÉn kho·∫£n ng√¢n h√†ng
                                        {% elif order.payment_method == 'credit_card' %}
                                            Th·∫ª t√≠n d·ª•ng
                                        {% endif %}
                                    </p>
                                    <p><strong>Tr·∫°ng th√°i thanh to√°n:</strong> 
                                        {% if order.payment_status == 'pending' %}
                                            <span style="color: #f39c12;">‚è≥ Ch∆∞a thanh to√°n</span>
                                        {% elif order.payment_status == 'paid' %}
                                            <span style="color: #27ae60;">‚úì ƒê√£ thanh to√°n</span>
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="order-total">
                                    T·ªïng ti·ªÅn: <strong style="color: #e74c3c;">{{ "{:,.0f}".format(order.total) }} ‚Ç´</strong>
                                </div>
                                <div style="margin-top: 15px; display: flex; gap: 10px;">
                                    <a href="{{ url_for('customer_order_detail', order_id=order.order_id) }}" class="btn btn-primary" style="flex: 1;">
                                        <i class="fas fa-eye"></i> Xem Chi Ti·∫øt
                                    </a>
                                    {% if order.status == 'pending' %}
                                    <form method="POST" action="{{ url_for('customer_cancel_order', order_id=order.order_id) }}" 
                                          onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?')" style="flex: 1;">
                                        <button type="submit" class="btn" style="width: 100%; background: #e74c3c; color: white;">
                                            <i class="fas fa-times"></i> H·ªßy ƒê∆°n
                                        </button>
                                    </form>
                                    {% endif %}
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p style="text-align: center; color: var(--text-light); padding: 3rem;">
                            <i class="fas fa-shopping-bag" style="font-size: 3rem; display: block; margin-bottom: 1rem;"></i>
                            B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o
                        </p>
                    {% endif %}
                </section>
                
                <section id="password" class="mt-5">
                    <h2>ƒê·ªïi M·∫≠t Kh·∫©u</h2>
                    <form method="POST" action="{{ url_for('change_customer_password') }}">
                        <div class="form-group">
                            <label for="current_password">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                            <input type="password" id="current_password" name="current_password" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="new_password">M·∫≠t kh·∫©u m·ªõi</label>
                            <input type="password" id="new_password" name="new_password" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirm_password">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                            <input type="password" id="confirm_password" name="confirm_password" required>
                        </div>
                        
                        <button type="submit" class="btn btn-warning">
                            <i class="fas fa-key"></i> ƒê·ªïi M·∫≠t Kh·∫©u
                        </button>
                    </form>
                </section>
            </main>
        </div>
    </div>
</div>

<script>
// Smooth scroll cho account menu
document.querySelectorAll('.account-menu a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        if (this.getAttribute('href') !== '#') {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Update active class
                document.querySelectorAll('.account-menu a').forEach(a => a.classList.remove('active'));
                this.classList.add('active');
            }
        }
    });
});
</script>
{% endblock %}