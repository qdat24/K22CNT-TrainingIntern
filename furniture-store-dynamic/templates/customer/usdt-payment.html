<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Thanh To√°n USDT - Web3 Payment</title>
    
    <!-- Web3.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .btn {
            padding: 16px 40px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            margin-bottom: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            width: 100%;
            padding: 20px;
            font-size: 1.2em;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(17, 153, 142, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .wallet-status {
            display: none;
            background: #f0f8ff;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 2px solid #667eea;
        }

        .wallet-status.show {
            display: block;
        }

        .wallet-info {
            margin: 10px 0;
            font-size: 1.05em;
        }

        .wallet-info strong {
            color: #2c3e50;
            display: inline-block;
            width: 150px;
        }

        .wallet-info span {
            color: #667eea;
            font-weight: 600;
        }

        .payment-details {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            border: 2px solid #dee2e6;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #dee2e6;
            font-size: 1.1em;
        }

        .detail-row:last-child {
            border-bottom: none;
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
            padding-top: 20px;
            margin-top: 10px;
            border-top: 2px solid #667eea;
        }

        .detail-label {
            color: #666;
        }

        .detail-value {
            font-weight: 700;
            color: #2c3e50;
        }

        /* Recipient Address Box - HIGHLIGHTED */
        .recipient-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
            border: 3px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .recipient-box h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recipient-box h3 i {
            font-size: 1.5em;
        }

        .address-display {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1.05em;
            word-break: break-all;
            color: #2c3e50;
            font-weight: 700;
            border: 2px solid #ffc107;
            margin: 10px 0;
        }

        .copy-btn {
            background: #ffc107;
            color: #856404;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #ffca2c;
            transform: translateY(-2px);
        }

        .network-selector {
            margin: 25px 0;
        }

        .network-selector label {
            display: block;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .network-selector select {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1.05em;
            cursor: pointer;
            background: white;
            transition: all 0.3s;
        }

        .network-selector select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .alert {
            padding: 20px 25px;
            border-radius: 12px;
            margin: 20px 0;
            display: none;
            font-size: 1.05em;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1em;
            color: #666;
        }

        .info-box {
            background: #e7f3ff;
            border: 2px solid #0066cc;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-box i {
            color: #0066cc;
            margin-right: 10px;
        }

        .info-box p {
            color: #004085;
            margin: 5px 0;
            font-size: 1.05em;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.05em;
            transition: all 0.3s;
        }

        .back-link:hover {
            color: #764ba2;
            transform: translateX(-5px);
        }

        .network-info {
            display: none;
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            border-left: 4px solid #667eea;
        }

        .network-info.show {
            display: block;
        }

        .network-info p {
            margin: 5px 0;
            color: #2c3e50;
        }

        @media (max-width: 768px) {
            .card {
                padding: 25px;
            }

            h1 {
                font-size: 2em;
            }

            .detail-row {
                font-size: 1em;
            }

            .wallet-info strong {
                width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üí∞ Thanh To√°n USDT</h1>
            <p class="subtitle">Thanh to√°n an to√†n qua MetaMask Wallet</p>

            <!-- Recipient Address - PROMINENTLY DISPLAYED -->
            <div class="recipient-box">
                <h3>
                    <i class="fas fa-wallet"></i>
                    ƒê·ªãa Ch·ªâ V√≠ Nh·∫≠n Ti·ªÅn
                </h3>
                <p style="color: #856404; margin-bottom: 10px;">
                    Vui l√≤ng chuy·ªÉn USDT ƒë·∫øn ƒë·ªãa ch·ªâ sau:
                </p>
                <div class="address-display" id="recipientAddressDisplay">
                    0x3fd86c3728b38cb6b09fa7d4914888dcfef1518c
                </div>
                <button class="copy-btn" onclick="copyAddress()">
                    <i class="fas fa-copy"></i> Sao Ch√©p ƒê·ªãa Ch·ªâ
                </button>
            </div>

            <!-- Payment Details -->
            <div class="payment-details">
                <div class="detail-row">
                    <span class="detail-label">üì¶ M√£ t·∫°m th·ªùi:</span>
                    <span class="detail-value" id="orderIdDisplay">Loading...</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">üí¥ S·ªë ti·ªÅn (VND):</span>
                    <span class="detail-value" id="amountVndDisplay">Loading...</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">üìä T·ª∑ gi√°:</span>
                    <span class="detail-value">1 USDT = 25,000 VND</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">üí∞ C·∫ßn thanh to√°n:</span>
                    <span class="detail-value" id="amountUsdtDisplay" style="color: #667eea; font-size: 1.5em;">
                        Loading... USDT
                    </span>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <p><i class="fas fa-info-circle"></i> <strong>H∆∞·ªõng d·∫´n thanh to√°n:</strong></p>
                <p>1Ô∏è‚É£ K·∫øt n·ªëi v√≠ MetaMask c·ªßa b·∫°n</p>
                <p>2Ô∏è‚É£ Ch·ªçn m·∫°ng blockchain (khuy·∫øn ngh·ªã BSC - ph√≠ th·∫•p)</p>
                <p>3Ô∏è‚É£ Ki·ªÉm tra s·ªë ti·ªÅn USDT c·∫ßn thanh to√°n</p>
                <p>4Ô∏è‚É£ X√°c nh·∫≠n giao d·ªãch trong MetaMask</p>
                <p>5Ô∏è‚É£ Ch·ªù x√°c nh·∫≠n t·ª´ blockchain (1-2 ph√∫t)</p>
            </div>

            <!-- Connect Wallet Button -->
            <button id="connectWalletBtn" class="btn btn-primary" onclick="connectWallet()">
                <i class="fas fa-wallet"></i> K·∫øt N·ªëi MetaMask
            </button>

            <!-- Wallet Status (Hidden by default) -->
            <div id="walletStatus" class="wallet-status">
                <div class="wallet-info">
                    <strong>üìç ƒê·ªãa ch·ªâ v√≠:</strong>
                    <span id="walletAddress">Ch∆∞a k·∫øt n·ªëi</span>
                </div>
                <div class="wallet-info">
                    <strong>üåê M·∫°ng:</strong>
                    <span id="networkName">Ch∆∞a ch·ªçn</span>
                </div>
                <div class="wallet-info">
                    <strong>üíµ S·ªë d∆∞ USDT:</strong>
                    <span id="usdtBalance">0.00</span> USDT
                </div>
            </div>

            <!-- Network Selector -->
            <div id="networkSelector" class="network-selector" style="display: none;">
                <label>Ch·ªçn m·∫°ng thanh to√°n:</label>
                <select id="networkSelect" onchange="handleNetworkChange()">
                    <option value="">-- Ch·ªçn blockchain --</option>
                    <option value="56">üü° BSC (Binance Smart Chain) - Ph√≠ th·∫•p ‚ú® (Khuy·∫øn ngh·ªã)</option>
                    <option value="137">üü£ Polygon - Nhanh & r·∫ª ‚ö°</option>
                    <option value="1">üîµ Ethereum - An to√†n nh·∫•t üîí</option>
                    <option value="97">üß™ BSC Testnet (Test)</option>
                    <option value="80001">üß™ Mumbai Testnet (Test)</option>
                </select>
                
                <div id="networkInfo" class="network-info">
                    <p><strong>üí° L∆∞u √Ω:</strong> ƒê·∫£m b·∫£o b·∫°n c√≥ ƒë·ªß USDT v√† token native (BNB/MATIC/ETH) ƒë·ªÉ tr·∫£ ph√≠ gas.</p>
                    <p><strong>üí∞ Ph√≠ giao d·ªãch d·ª± ki·∫øn:</strong> <span id="estimatedFee">~$0.50</span></p>
                </div>
            </div>

            <!-- Pay Button (Hidden by default) -->
            <button id="payNowBtn" class="btn btn-success" style="display: none;" onclick="processPayment()">
                üí∏ Thanh To√°n <span id="payAmount"></span> USDT
            </button>

            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p class="loading-text">ƒêang x·ª≠ l√Ω giao d·ªãch...</p>
            </div>

            <!-- Alert Container -->
            <div id="alertContainer"></div>

            <!-- Back Link -->
            <a href="/checkout" class="back-link">
                <i class="fas fa-arrow-left"></i> Quay l·∫°i trang thanh to√°n
            </a>
        </div>
    </div>

    <script>
        // ========================================
        // GLOBAL VARIABLES
        // ========================================
        let web3;
        let userAccount;
        let selectedChainId;
        let tempOrderId;
        let totalAmount;
        let usdtAmount;

        const USDT_RATE = 25000; // 1 USDT = 25,000 VND
        const RECIPIENT_ADDRESS = '0x3fd86c3728b38cb6b09fa7d4914888dcfef1518c'; // ‚ö†Ô∏è THAY ƒê·ªäA CH·ªà V√ç C·ª¶A B·∫†N

        // Network configurations
        const NETWORKS = {
            1: {
                name: 'Ethereum Mainnet',
                usdtAddress: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                explorer: 'https://etherscan.io',
                estimatedFee: '$5-15'
            },
            56: {
                name: 'BSC Mainnet',
                usdtAddress: '0x55d398326f99059fF775485246999027B3197955',
                explorer: 'https://bscscan.com',
                estimatedFee: '$0.20-0.50'
            },
            137: {
                name: 'Polygon',
                usdtAddress: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F',
                explorer: 'https://polygonscan.com',
                estimatedFee: '$0.10-0.30'
            },
            97: {
                name: 'BSC Testnet',
                usdtAddress: '0x337610d27c682E347C9cD60BD4b3b107C9d34dDd',
                explorer: 'https://testnet.bscscan.com',
                estimatedFee: 'Free (Test)'
            },
            80001: {
                name: 'Mumbai Testnet',
                usdtAddress: '0x3813e82e6f7098b9583FC0F33a962D02018B6803',
                explorer: 'https://mumbai.polygonscan.com',
                estimatedFee: 'Free (Test)'
            }
        };

        // USDT ABI (minimal - only transfer function)
        const USDT_ABI = [
            {
                "constant": false,
                "inputs": [
                    {"name": "_to", "type": "address"},
                    {"name": "_value", "type": "uint256"}
                ],
                "name": "transfer",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [{"name": "who", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "decimals",
                "outputs": [{"name": "", "type": "uint8"}],
                "type": "function"
            }
        ];

        // ========================================
        // INITIALIZATION
        // ========================================
        window.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            tempOrderId = urlParams.get('temp_id');
            totalAmount = parseFloat(urlParams.get('amount')) || 0;

            // Calculate USDT amount
            usdtAmount = (totalAmount / USDT_RATE).toFixed(2);

            // Update display
            document.getElementById('orderIdDisplay').textContent = tempOrderId || 'N/A';
            document.getElementById('amountVndDisplay').textContent = totalAmount.toLocaleString('vi-VN') + '‚Ç´';
            document.getElementById('amountUsdtDisplay').textContent = usdtAmount + ' USDT';
            document.getElementById('recipientAddressDisplay').textContent = RECIPIENT_ADDRESS;

            console.log('üöÄ Payment initialized:', {
                tempOrderId: tempOrderId,
                totalAmount: totalAmount,
                usdtAmount: usdtAmount,
                recipientAddress: RECIPIENT_ADDRESS
            });
        });

        // Copy address to clipboard
        function copyAddress() {
            navigator.clipboard.writeText(RECIPIENT_ADDRESS).then(function() {
                showAlert('‚úÖ ƒê√£ sao ch√©p ƒë·ªãa ch·ªâ v√†o clipboard!', 'success');
            }, function() {
                showAlert('‚ùå Kh√¥ng th·ªÉ sao ch√©p. Vui l√≤ng copy th·ªß c√¥ng.', 'danger');
            });
        }

        // ========================================
        // WALLET CONNECTION
        // ========================================
        async function connectWallet() {
            showLoading(true);
            
            try {
                // Check if MetaMask is installed
                if (typeof window.ethereum === 'undefined') {
                    showAlert('‚ùå Vui l√≤ng c√†i ƒë·∫∑t MetaMask ƒë·ªÉ ti·∫øp t·ª•c!', 'danger');
                    window.open('https://metamask.io/download/', '_blank');
                    showLoading(false);
                    return;
                }

                // Initialize Web3
                web3 = new Web3(window.ethereum);

                // Request account access
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                userAccount = accounts[0];

                // Update UI
                document.getElementById('walletAddress').textContent = 
                    userAccount.substring(0, 6) + '...' + userAccount.substring(38);
                document.getElementById('walletStatus').classList.add('show');
                document.getElementById('networkSelector').style.display = 'block';
                document.getElementById('connectWalletBtn').style.display = 'none';

                showAlert('‚úÖ K·∫øt n·ªëi v√≠ th√†nh c√¥ng! Vui l√≤ng ch·ªçn m·∫°ng blockchain.', 'success');
                showLoading(false);

                console.log('‚úÖ Wallet connected:', userAccount);

            } catch (error) {
                console.error('‚ùå Connection error:', error);
                showAlert('‚ùå L·ªói k·∫øt n·ªëi: ' + error.message, 'danger');
                showLoading(false);
            }
        }

        // ========================================
        // NETWORK HANDLING
        // ========================================
        async function handleNetworkChange() {
            const networkSelect = document.getElementById('networkSelect');
            selectedChainId = parseInt(networkSelect.value);

            if (!selectedChainId) {
                document.getElementById('payNowBtn').style.display = 'none';
                return;
            }

            showLoading(true);

            try {
                const network = NETWORKS[selectedChainId];
                
                // Switch network
                await switchNetwork(selectedChainId);

                // Update network display
                document.getElementById('networkName').textContent = network.name;
                document.getElementById('networkInfo').classList.add('show');
                document.getElementById('estimatedFee').textContent = network.estimatedFee;

                // Get USDT balance
                const balance = await getUSDTBalance();
                document.getElementById('usdtBalance').textContent = balance.toFixed(2);

                // Update pay button
                document.getElementById('payAmount').textContent = usdtAmount;

                // Check if user has enough USDT
                if (balance < parseFloat(usdtAmount)) {
                    showAlert('‚ö†Ô∏è S·ªë d∆∞ USDT kh√¥ng ƒë·ªß! B·∫°n c√≥: ' + balance.toFixed(2) + ' USDT, c·∫ßn: ' + usdtAmount + ' USDT.', 'danger');
                    document.getElementById('payNowBtn').style.display = 'none';
                } else {
                    document.getElementById('payNowBtn').style.display = 'block';
                    showAlert('‚úÖ S·∫µn s√†ng thanh to√°n! Nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ ti·∫øp t·ª•c.', 'success');
                }

                showLoading(false);

            } catch (error) {
                console.error('‚ùå Network change error:', error);
                showAlert('‚ùå L·ªói chuy·ªÉn m·∫°ng: ' + error.message, 'danger');
                showLoading(false);
            }
        }

        async function switchNetwork(chainId) {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x' + chainId.toString(16) }]
                });
            } catch (error) {
                // Network doesn't exist, add it
                if (error.code === 4902) {
                    throw new Error('Vui l√≤ng th√™m m·∫°ng n√†y v√†o MetaMask tr∆∞·ªõc!');
                }
                throw error;
            }
        }

        // ========================================
        // USDT OPERATIONS
        // ========================================
        async function getUSDTBalance() {
            const network = NETWORKS[selectedChainId];
            const usdtContract = new web3.eth.Contract(USDT_ABI, network.usdtAddress);
            
            const balance = await usdtContract.methods.balanceOf(userAccount).call();
            const decimals = await usdtContract.methods.decimals().call();
            
            return balance / Math.pow(10, decimals);
        }

        // ========================================
        // PAYMENT PROCESSING
        // ========================================
        async function processPayment() {
            showLoading(true);
            document.getElementById('payNowBtn').disabled = true;

            try {
                const network = NETWORKS[selectedChainId];
                const usdtContract = new web3.eth.Contract(USDT_ABI, network.usdtAddress);
                
                // Get decimals
                const decimals = await usdtContract.methods.decimals().call();
                
                // Calculate amount in smallest unit
                const amount = web3.utils.toBN(Math.floor(parseFloat(usdtAmount) * Math.pow(10, decimals)));

                console.log('üí∏ Sending payment:', {
                    to: RECIPIENT_ADDRESS,
                    amount: usdtAmount + ' USDT',
                    rawAmount: amount.toString(),
                    network: network.name
                });

                showAlert('‚è≥ Vui l√≤ng x√°c nh·∫≠n giao d·ªãch trong MetaMask...', 'info');

                // Send transaction
                const tx = await usdtContract.methods
                    .transfer(RECIPIENT_ADDRESS, amount)
                    .send({ from: userAccount });

                console.log('‚úÖ Transaction successful:', tx);

                showAlert('‚úÖ Giao d·ªãch th√†nh c√¥ng! ƒêang t·∫°o ƒë∆°n h√†ng...', 'success');

                // Create order in backend
                await createOrderAfterPayment(tx.transactionHash);

                // Redirect to success page
                setTimeout(() => {
                    window.location.href = '/order-success?temp_id=' + tempOrderId + 
                                          '&tx_hash=' + tx.transactionHash +
                                          '&network=' + network.name;
                }, 2000);

            } catch (error) {
                console.error('‚ùå Payment error:', error);
                
                if (error.code === 4001) {
                    showAlert('‚ùå B·∫°n ƒë√£ t·ª´ ch·ªëi giao d·ªãch.', 'danger');
                } else {
                    showAlert('‚ùå Thanh to√°n th·∫•t b·∫°i: ' + error.message, 'danger');
                }
                
                showLoading(false);
                document.getElementById('payNowBtn').disabled = false;
            }
        }

        async function createOrderAfterPayment(txHash) {
            try {
                // Get order data from sessionStorage
                const orderDataStr = sessionStorage.getItem('pending_order_data');
                if (!orderDataStr) {
                    throw new Error('Kh√¥ng t√¨m th·∫•y th√¥ng tin ƒë∆°n h√†ng');
                }

                const orderData = JSON.parse(orderDataStr);
                
                // Add payment info
                orderData.payment_method = 'usdt';
                orderData.tx_hash = txHash;
                orderData.chain_id = selectedChainId;
                orderData.usdt_amount = usdtAmount;
                
                // Call backend to create order
                const response = await fetch('/api/place-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });

                const result = await response.json();
                
                if (result.success) {
                    console.log('‚úÖ Order created:', result.order_id);
                    // Clear session storage
                    sessionStorage.removeItem('pending_order_data');
                    sessionStorage.removeItem('order_total');
                } else {
                    console.error('‚ùå Failed to create order:', result);
                }
            } catch (error) {
                console.error('‚ùå Error creating order:', error);
            }
        }

        // ========================================
        // UI HELPERS
        // ========================================
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} show`;
            alert.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
            
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 8000);
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('show', show);
        }
    </script>
</body>
</html>