{% extends "admin/base.html" %}

{% block title %}Chi Ti·∫øt ƒê∆°n H√†ng {{ order.order_id }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üì¶ Chi Ti·∫øt ƒê∆°n H√†ng</h1>
    <p>M√£ ƒë∆°n h√†ng: <strong>{{ order.order_id }}</strong></p>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
    <!-- Th√¥ng tin ƒë∆°n h√†ng -->
    <div>
        <div class="card">
            <div class="card-header">
                <h3>üìã Th√¥ng Tin Kh√°ch H√†ng</h3>
            </div>
            <table style="width: 100%;">
                <tr>
                    <td style="padding: 10px; font-weight: 600; width: 150px;">H·ªç T√™n:</td>
                    <td style="padding: 10px;">{{ order.customer_name }}</td>
                </tr>
                <tr>
                    <td style="padding: 10px; font-weight: 600;">S·ªë ƒêi·ªán Tho·∫°i:</td>
                    <td style="padding: 10px;">{{ order.phone }}</td>
                </tr>
                <tr>
                    <td style="padding: 10px; font-weight: 600;">Email:</td>
                    <td style="padding: 10px;">{{ order.email if order.email else 'Kh√¥ng c√≥' }}</td>
                </tr>
                <tr>
                    <td style="padding: 10px; font-weight: 600;">ƒê·ªãa Ch·ªâ:</td>
                    <td style="padding: 10px;">{{ order.address }}</td>
                </tr>
                <tr>
                    <td style="padding: 10px; font-weight: 600;">Ghi Ch√∫:</td>
                    <td style="padding: 10px;">{{ order.note if order.note else 'Kh√¥ng c√≥' }}</td>
                </tr>
            </table>
        </div>

        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <h3>üõçÔ∏è S·∫£n Ph·∫©m ƒê√£ ƒê·∫∑t</h3>
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th>S·∫£n Ph·∫©m</th>
                        <th>ƒê∆°n Gi√°</th>
                        <th>S·ªë L∆∞·ª£ng</th>
                        <th>Th√†nh Ti·ªÅn</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order['items'] %}
                    <tr>
                        <td>
                            <strong>{{ item.product_name }}</strong><br>
                            <small style="color: #666;">ID: {{ item.product_id }}</small>
                        </td>
                        <td>{{ "{:,.0f}".format(item.price) }} ‚Ç´</td>
                        <td>{{ item.quantity }}</td>
                        <td><strong>{{ "{:,.0f}".format(item.subtotal) }} ‚Ç´</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; padding: 10px; font-weight: 600;">T·∫°m t√≠nh:</td>
                        <td style="padding: 10px;"><strong>{{ "{:,.0f}".format(order.subtotal) }} ‚Ç´</strong></td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: right; padding: 10px; font-weight: 600;">Ph√≠ v·∫≠n chuy·ªÉn:</td>
                        <td style="padding: 10px;"><strong>{{ "{:,.0f}".format(order.shipping_fee) }} ‚Ç´</strong></td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                        <td colspan="3" style="text-align: right; padding: 15px; font-weight: 600; font-size: 18px;">T·ªïng c·ªông:</td>
                        <td style="padding: 15px;"><strong style="font-size: 18px; color: #e74c3c;">{{ "{:,.0f}".format(order.total) }} ‚Ç´</strong></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- C·∫≠p nh·∫≠t tr·∫°ng th√°i -->
    <div>
        <div class="card">
            <div class="card-header">
                <h3>‚öôÔ∏è Th√¥ng Tin ƒê∆°n H√†ng</h3>
            </div>
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <strong>Ng√†y ƒê·∫∑t:</strong><br>
                    {{ order.created_at.strftime('%d/%m/%Y %H:%M:%S') if order.created_at else 'N/A' }}
                </div>

                <div style="margin-bottom: 20px;">
                    <strong>Ph∆∞∆°ng Th·ª©c Thanh To√°n:</strong><br>
                    {% if order.payment_method == 'cod' %}
                        üíµ Thanh to√°n khi nh·∫≠n h√†ng (COD)
                    {% elif order.payment_method == 'bank_transfer' %}
                        üè¶ Chuy·ªÉn kho·∫£n ng√¢n h√†ng
                    {% elif order.payment_method == 'credit_card' %}
                        üí≥ Th·∫ª t√≠n d·ª•ng
                    {% else %}
                        {{ order.payment_method }}
                    {% endif %}
                </div>

                <div style="margin-bottom: 20px;">
                    <strong>Tr·∫°ng Th√°i Hi·ªán T·∫°i:</strong><br>
                    {% if order.status == 'pending' %}
                        <span style="color: #f39c12; font-weight: bold; font-size: 16px;">‚è≥ Ch·ªù x·ª≠ l√Ω</span>
                    {% elif order.status == 'confirmed' %}
                        <span style="color: #3498db; font-weight: bold; font-size: 16px;">‚úì ƒê√£ x√°c nh·∫≠n</span>
                    {% elif order.status == 'shipping' %}
                        <span style="color: #9b59b6; font-weight: bold; font-size: 16px;">üöö ƒêang giao h√†ng</span>
                    {% elif order.status == 'completed' %}
                        <span style="color: #27ae60; font-weight: bold; font-size: 16px;">‚úì Ho√†n th√†nh</span>
                    {% elif order.status == 'cancelled' %}
                        <span style="color: #e74c3c; font-weight: bold; font-size: 16px;">‚úó ƒê√£ h·ªßy</span>
                    {% else %}
                        {{ order.status }}
                    {% endif %}
                </div>

                <div style="margin-bottom: 30px;">
                    <strong>Tr·∫°ng Th√°i Thanh To√°n:</strong><br>
                    {% if order.payment_status == 'pending' %}
                        <span style="color: #f39c12; font-weight: bold; font-size: 16px;">‚è≥ Ch∆∞a thanh to√°n</span>
                    {% elif order.payment_status == 'paid' %}
                        <span style="color: #27ae60; font-weight: bold; font-size: 16px;">‚úì ƒê√£ thanh to√°n</span>
                    {% else %}
                        {{ order.payment_status }}
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <h3>‚ö° H√†nh ƒê·ªông Nhanh</h3>
            </div>
            <div style="padding: 20px;">
                {% if order.status == 'pending' %}
                    <!-- ƒê∆°n h√†ng ch·ªù x·ª≠ l√Ω -->
                    <form method="POST" action="{{ url_for('admin_update_order_status', order_id=order.order_id) }}" style="margin-bottom: 10px;">
                        <input type="hidden" name="status" value="confirmed">
                        <input type="hidden" name="payment_status" value="{{ order.payment_status }}">
                        <button type="submit" class="btn" style="width: 100%; background: #27ae60; color: white; padding: 15px; font-size: 16px; font-weight: 600;">
                            ‚úì X√°c Nh·∫≠n ƒê∆°n H√†ng
                        </button>
                    </form>
                    <form method="POST" action="{{ url_for('admin_update_order_status', order_id=order.order_id) }}" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?')">
                        <input type="hidden" name="status" value="cancelled">
                        <input type="hidden" name="payment_status" value="{{ order.payment_status }}">
                        <button type="submit" class="btn" style="width: 100%; background: #e74c3c; color: white; padding: 12px;">
                            ‚úó H·ªßy ƒê∆°n H√†ng
                        </button>
                    </form>
                
                {% elif order.status == 'confirmed' %}
                    <!-- ƒê∆°n h√†ng ƒë√£ x√°c nh·∫≠n -->
                    <form method="POST" action="{{ url_for('admin_update_order_status', order_id=order.order_id) }}" style="margin-bottom: 10px;">
                        <input type="hidden" name="status" value="shipping">
                        <input type="hidden" name="payment_status" value="{{ order.payment_status }}">
                        <button type="submit" class="btn" style="width: 100%; background: #9b59b6; color: white; padding: 15px; font-size: 16px; font-weight: 600;">
                            üöö Chuy·ªÉn Sang Giao H√†ng
                        </button>
                    </form>
                    <form method="POST" action="{{ url_for('admin_update_order_status', order_id=order.order_id) }}" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?')">
                        <input type="hidden" name="status" value="cancelled">
                        <input type="hidden" name="payment_status" value="{{ order.payment_status }}">
                        <button type="submit" class="btn" style="width: 100%; background: #e74c3c; color: white; padding: 12px;">
                            ‚úó H·ªßy ƒê∆°n H√†ng
                        </button>
                    </form>
                
                {% elif order.status == 'shipping' %}
                    <!-- ƒêang giao h√†ng -->
                    <form method="POST" action="{{ url_for('admin_update_order_status', order_id=order.order_id) }}">
                        <input type="hidden" name="status" value="completed">
                        <input type="hidden" name="payment_status" value="paid">
                        <button type="submit" class="btn" style="width: 100%; background: #27ae60; color: white; padding: 15px; font-size: 16px; font-weight: 600;">
                            ‚úì Ho√†n Th√†nh Giao H√†ng
                        </button>
                    </form>
                
                {% elif order.status == 'completed' %}
                    <!-- ƒê√£ ho√†n th√†nh -->
                    <div style="text-align: center; padding: 20px; background: #d4edda; border-radius: 8px; color: #155724;">
                        <i class="fas fa-check-circle" style="font-size: 48px; margin-bottom: 10px;"></i>
                        <div style="font-weight: 600; font-size: 16px;">ƒê∆°n h√†ng ƒë√£ ho√†n th√†nh</div>
                        <small>Kh√¥ng th·ªÉ thay ƒë·ªïi tr·∫°ng th√°i</small>
                    </div>
                
                {% elif order.status == 'cancelled' %}
                    <!-- ƒê√£ h·ªßy -->
                    <div style="text-align: center; padding: 20px; background: #f8d7da; border-radius: 8px; color: #721c24;">
                        <i class="fas fa-times-circle" style="font-size: 48px; margin-bottom: 10px;"></i>
                        <div style="font-weight: 600; font-size: 16px;">ƒê∆°n h√†ng ƒë√£ b·ªã h·ªßy</div>
                        <small>Kh√¥ng th·ªÉ thay ƒë·ªïi tr·∫°ng th√°i</small>
                    </div>
                {% endif %}

                <!-- C·∫≠p nh·∫≠t tr·∫°ng th√°i thanh to√°n cho COD -->
                {% if order.status not in ['cancelled', 'completed'] and order.payment_method == 'cod' and order.payment_status == 'pending' %}
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                    <form method="POST" action="{{ url_for('admin_update_order_status', order_id=order.order_id) }}">
                        <input type="hidden" name="status" value="{{ order.status }}">
                        <input type="hidden" name="payment_status" value="paid">
                        <button type="submit" class="btn" style="width: 100%; background: #3498db; color: white; padding: 12px;">
                            üí∞ X√°c Nh·∫≠n ƒê√£ Thu Ti·ªÅn COD
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>

        <div style="margin-top: 20px;">
            <a href="{{ url_for('admin_orders') }}" class="btn btn-primary" style="width: 100%; text-align: center;">‚Üê Quay L·∫°i Danh S√°ch</a>
        </div>
    </div>
</div>
{% endblock %}